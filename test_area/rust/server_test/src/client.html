<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Dorian Gray</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  #container { position: relative; width:100vw; height:100vh; }

  /* Frame container */
  .frame {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
  }

  .frame img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .frame .text {
    text-align: center;
    pointer-events: none;
    color: white;
    font-weight: bold;
  }

  /* NEW: padded overlay area for text */
  .frame-text-area {
    position: absolute;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .line {
    position: absolute;
    transition: opacity 0.5s ease;
    opacity: 0;
    text-align: center;
  }
  .visible { opacity: 1; }
</style>
</head>
<body>
  <div id="container"></div>

<script>
function connectWS() {
  const ws = new WebSocket(`ws://${location.host}/ws`);
  ws.onmessage = ev => {
    const msg = JSON.parse(ev.data);

    // If image, wrap in frame container
    if (msg.media && msg.media.kind === 'image') {
      const frame = document.createElement('div');
      frame.className = 'frame';

      frame.style.left = msg.style.position.x || '50%';
      frame.style.top  = msg.style.position.y || '0';
      frame.style.transform = 'translate(-50%, 0)';

      const img = document.createElement('img');
      img.src = msg.media.url;

      if (msg.media.img_size) {
        frame.style.width  = msg.media.img_size.width;
        frame.style.height = msg.media.img_size.height;
      }

      frame.appendChild(img);
      container.appendChild(frame);

      // Wait for image before placing text
      img.onload = () => {
        // Create padded text area overlay
        const textArea = document.createElement('div');
        textArea.className = 'frame-text-area';

        if (msg.media.padding) {
          textArea.style.padding =
            `${msg.media.padding.top} `
          + `${msg.media.padding.right} `
          + `${msg.media.padding.bottom} `
          + `${msg.media.padding.left}`;
        }

        // Add text inside the padded area
        const textDiv = document.createElement('div');
        textDiv.className = 'text';
        textDiv.textContent = msg.text;

        if (msg.style) {
          textDiv.style.color = msg.style.color;
          textDiv.style.fontSize = msg.style.font_size;
          textDiv.style.fontFamily = msg.style.font_family;
        }

        textArea.appendChild(textDiv);
        frame.appendChild(textArea);
      };

      setTimeout(() => frame.remove(), msg.media.duration_ms || 5000);
    }
  };

  ws.onclose = () => setTimeout(connectWS, 100);
  ws.onerror = () => ws.close();
}

connectWS();
</script>
</body>
</html>
